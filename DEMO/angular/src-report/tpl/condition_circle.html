<!-- 环比 -->
<div class="condition_div">
	<li>
		<div class="item-content item-relative">
	    	<label><span tkey="circle"></span>:</label>
		    <div class="item-input">
		      	<!--relative-value 表示 一个输入框 对应 一个 右侧划入的列表-->
		      	<input type="text" placeholder="请选择需汇总统计项目" class="btn-panel relative-value" data-rel="panel-circle" readonly="" data-value="storage" value="">
		    </div>
	  	</div>
	</li>
</div>
<div class="panel panel-right panel-cover" id='panel-circle'>
    <header>
	    <a href="#" class="close-panel back"></a>  
	    <span tkey="circle"></span>
	    <a href="#" class="close-panel confirm confirm" tkey="sure"></a>
    </header>
   	
    <!-- Click on link with "close-panel" class will close panel -->
    <div class="list-block">
      	<p class="small" tkey="total_desc"></p>
      	<ul>
        	<!-- Single chekbox item -->
        	<li tkey="loading"></li>
      	</ul>
    </div>
</div>

<script>
	jQuery(document).ready(function($){
	    $('.condition_div li').appendTo($('#condition_ul'));

	    // 条件从缓存获取
	  	// 环比
	  	var filter_circle = form_id + '_filter_circle';
		if(localStorage[filter_circle]){
		  	$('.filter_circle').html(localStorage[filter_circle]);
		}

		//init 环比
		var xhr;
        if(xhr){
          	xhr.abort();
      	}
		xhr = $.ajax({
        	url: API_URL_PREFIX+API_URL['sale_chain_rate_section'],
        	data: JSON.stringify({}),
        	type: 'POST',
        	dataType : "json",
        	contentType: "application/json",
        	success:  function(data){
                if(data.code != 0){
                  	_error_handle(data);
                  	return;
                }
           		data = data.data;
                var str = '';
                var checked_reason = '';
                var section = form_id + '_section';

                for(i=0;i<data.data.length;i++){
                    var name = data.data[i]['type_name'];
                    var code = data.data[i]['type_code'];
                    if(localStorage[section]!=undefined && localStorage[section]!='' && localStorage[section]!=null){
                            checked_reason = (localStorage[section].split(',').indexOf(code+'') != -1)?'checked':'';
                    }
                    str += '<li><label class="lb" for="circle'+i+'">\
                          '+ name +'\
                          <span class="checkbox">\
                            <span class="input-radio '+ checked_reason +'">\
                              <input type="radio" name="circle" id="circle'+i+'" value="'+ code +'" data-label="'+ name +'" />\
                              <span class="inner"></span>\
                            </span>\
                          </span></label>\
                        </li>';
                }
                $('#panel-circle ul').html(str);
                $(document).on("click", "#panel-circle .close-panel.confirm", function() {
                  	var s = '';
                  	if($(this).parents('.panel').find('input[type=radio]').size() == $(this).parents('.panel').find('input[type=radio]:checked').size()){
                    	s = '全部环比类型';
                  	}else{
                    	$(this).parents('.panel').find('input[type=radio]:checked').each(function(){
                            if(s != ''){
                                s += ',';
                            }
                            s +=  $(this).attr('data-label');
                        });
                  	}
                  	$('input[data-value="storage"]').val(s);
                  	// sessionStorage.setItem('reason4',s)
                  	$('.filter_circle').html(s);
              	});
                
                //条件从缓存获取
                var filter_circle = form_id + '_filter_circle';
              	if(localStorage[filter_circle]!='' && localStorage[filter_circle]!=undefined){
              	  	$('.filter_circle').html(localStorage[filter_circle]);
              	  	$('input[data-value="storage"]').val(localStorage[filter_circle]);
              	    $("#panel-circle ul li .input-radio input[value='"+localStorage[section]+"']").click();
              	}else{
              	  	// 默认选中
              	  	$('#panel-circle ul li:first-child .input-radio input').click();
              	}
              	$('#panel-circle .close-panel.confirm').click();
          	},
          	error:    function(data){
            	console.log('error');
            	_error_handle(data);
          	},
          	complete: function(){
            	console.log('complete');
          	},
          	beforeSend : function(request){
            	request.setRequestHeader("token", token);
          	}
        })
	})
</script>