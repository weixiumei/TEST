<html>
  <head>
    <meta utf-8>
  <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/colreorder/1.5.1/css/colReorder.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/rowreorder/1.2.5/css/rowReorder.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedcolumns/3.2.6/css/fixedColumns.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.1.5/css/fixedHeader.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css"> -->
  <!-- <link rel="stylesheet" type="text/css" href="./main.css"> -->
  <link rel="stylesheet" type="text/css" href="">
    <style>
      /* .grip {
        width:20px;
        height:30px;
        margin-top: 40px;
        background-image:url(./grip.png);
        margin-left:-5px;
        position:relative;
        z-index:88;
        cursor:e-resize
      } */
      .JCLRgrip .JColResizer{
        background: #d5d5d5!important;
        opacity: 1!important;
      }
      th, td{
        border: 1px solid red;
      }
    </style>

  </head>
  <body>
    <!-- <button id="reset" style="height: 40px;margin: 10px 0;">reset</button> -->
    <table id="example" class="display" style="width:100%;text-align: center;">
      <!-- <thead>
        <tr>
        </tr>
      </thead> -->
    </table>
  </body>
  <script type="text/javascript" charset="utf8" src="./jquery-1.8.3.js"></script>
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/colreorder/1.5.1/js/dataTables.colReorder.min.js"></script> -->
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/rowreorder/1.2.5/js/dataTables.rowReorder.min.js"></script> -->
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script> -->
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js"></script> -->
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedcolumns/3.2.6/js/dataTables.fixedColumns.min.js"></script> -->
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedheader/3.1.5/js/dataTables.fixedHeader.min.js"></script> -->
  <!-- <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script> -->

  <script type="text/javascript" charset="utf8" src="./jquery.dataTables.min.js"></script>
  <script type="text/javascript" charset="utf8" src="./dataTables.colReorder.min.js"></script>
  <script type="text/javascript" charset="utf8" src="./dataTables.colReorder.js"></script>
  <!-- <script type="text/javascript" charset="utf8" src="./colResizable-1.6.js"></script> -->
  <script type="text/javascript" charset="utf8" src="./testResize.js"></script>
  <!-- <script type="text/javascript" charset="utf-8" src="./ColReorderWithResize.js"></script> -->
 
<!-- DataTables -->
<!-- <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.js"></script> -->
 
  <!-- <script src="./all.js"></script> -->
  
  <!-- http://www.bacubacu.com/colresizable/#download -->
  <!-- https://datatables.net/forums/discussion/26786/basic-column-resizing-plugin -->
  <script>
    var data = [
      // {"name":"Tiger Nixon1","position":"System Architect","salary":"$3,120"}
      {"name":"Tiger Nixon1Nixon1Nixon1Nixon1Nixon1Nixon1Nixon1","position":"System Architect","salary":"$3,120","start_date":"2011/04/25","office":"Edinburgh","extn":"5421"},
      {"name":"Garrett Winters2","position":"Director","salary":"$5,300","start_date":"2011/07/25","office":"Edinburgh","extn":"8422"},
      {"name":"Garrett Winters3","position":"Director","salary":"$5,300","start_date":"2011/07/25","office":"Edinburgh","extn":"8422"}
    ];
    var columns_data = [
      { name: '名字' },
      { position: '定位' },
      { salary: '价格' },
      { office: '办公' },
      { extn: '数量' }
    ]
    var table_example = ''
    function setColumns(table_headers) {
      var th_html = '',
        columns = []
      for (var i = 0; i < table_headers.length; i++) {
        for (var ss in table_headers[i]) {
          th_html = th_html + '<th data-code="' + ss + '">' + table_headers[i][ss] + '</th>'
          columns.push({
            data: ss
          })
        }
      }
      $('table thead tr').html(th_html)
      return columns;
    }
    var columns = [
      { title: '名字', data: 'name' },
      { title: '定位', data: 'position' },
      { title: '价格', data: 'salary' },
      { title: '办公', data: 'office' },
      { title: '数量', data: 'extn' }
    ]

    $(document).ready(function() {
      var table = $('#example').DataTable( {
        columns:    columns,
        data:       data,
        // "scrollX": true,
        // "autoWidth": false,
        colReorder: {
          realtime: false
        },
        // rowReorder: true,
        // fixedHeader: true,
        // responsive: true,
        stateSave:  true,
        // "stateSaveParams": function (settings, data) {
        //   // data.search.search = "";
        //   console.log(11)

        // },
        // autoFill: true,
        // rowReorder: {
        //     selector: 'td:nth-child(2)'
        // },
        // paging: false,//是否分页
        //显示隐藏列
        // dom: 'Bfrtip',
        // buttons: [
        //   'colvis' 
        // ],
        // colReorder: {
        //   指定顺序
        //   order: [ 4, 3, 2, 1, 0 ]
        //   节约性能
        //   realtime: false
        // }
        initComplete: function(settings) {
          $('#example').colResizable({
            // postbackSafe: true,//刷新后保留之前的拖拽宽度
            liveDrag:true, 
            resizeMode:'overflow',
            gripInnerHtml:"<div class='grip'></div>", 
            draggingClass:"dragging", 
          })
        },
        drawCallback: function(settings){
          console.log(settings)
          setTimeout(function(){

            if(!!table){
              // console.log(settings, data.ColReorder)
              console.log('------------拖拽条位置--------------')
              var JCLRgrip = $('.JCLRgrips .JCLRgrip')
              // 两个拖拽条之间的距离
              for(var i=0; i<JCLRgrip.length;i++){
                console.log(i, 1*$('.JCLRgrips .JCLRgrip')[i].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i].style.left.indexOf('px')))
                // if(i==0){
                //   console.log(i, 1*$('.JCLRgrips .JCLRgrip')[i].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i].style.left.indexOf('px')))
                // }else{
                //   console.log(i, 
                //     $('.JCLRgrips .JCLRgrip')[i].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i].style.left.indexOf('px'))
                //     -
                //     $('.JCLRgrips .JCLRgrip')[i-1].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i-1].style.left.indexOf('px'))
                //   )
                // }
              }
              console.log('------------th宽度--------------')
              // table 表格宽度
              for(var i=0; i<$('table th').length;i++){
                console.log(i, $('table th')[i].style.width)
              }
            }
          })
        },
        stateSaveCallback: function(settings, data) {
          if(!!table){
            var options = {
              disable: false,
              disabledColumns: [],
              dragCursor: "e-resize",
              draggingClass: "JCLRgripDrag",
              fixed: true,
              flush: false,
              gripInnerHtml: "",
              headerOnly: false,
              hoverCursor: "e-resize",
              liveDrag: true,
              marginLeft: null,
              marginRight: null,
              minWidth: 15,
              onDrag: null,
              onResize: null,
              overflow: false,
              partialRefresh: false,
              postbackSafe: false,
              resizeMode: "fit"
            }
            colResizable.init( $('table'), options);
            // createGrips($('table'))
            console.log(settings, data.ColReorder)
            console.log('--------------------------')
            var JCLRgrip = $('.JCLRgrips .JCLRgrip')
            // 两个拖拽条之间的距离
            for(var i=0; i<JCLRgrip.length;i++){
              if(i==0){
                console.log(i, 1*$('.JCLRgrips .JCLRgrip')[i].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i].style.left.indexOf('px')))
              }else{
                console.log(i, 
                  $('.JCLRgrips .JCLRgrip')[i].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i].style.left.indexOf('px'))
                  -
                  $('.JCLRgrips .JCLRgrip')[i-1].style.left.substring(0, $('.JCLRgrips .JCLRgrip')[i-1].style.left.indexOf('px'))
                )
              }
            }
            console.log('--------------------------')
            // table 表格宽度
            for(var i=0; i<$('table th').length;i++){
              console.log(i, $('table th')[i].style.width)
            }
            
            // for (var e = 0; e < t.ln; e++) {
            //   var i = t.c[e];
            //   t.g[e].css({
            //     left: i.offset().left - t.offset().left + i.outerWidth(!1) + t.cs / 2 + a,
            //     height: t.opt.headerOnly ? t.c[0].outerHeight(!1) : t.outerHeight(!1)
            //   })
            // }
          }
        }
      })
      // 重置
      // $('#reset').click( function (e) {
      //   e.preventDefault();
      //   table.colReorder.reset();
      // });
      // new $.fn.dataTable.FixedColumns( table, {
      //   leftColumns: 1,
      //   rightColumns: 1
      // });
      // $('#example').colResizable({
      //   // liveDrag:true, 
      //   // resizeMode:'flex'
      //   // liveDrag:true,
      //   // gripInnerHtml:"<div class='grip'></div>", 
      //   // draggingClass:"dragging", 
      //   // onResize:onSampleResized
      // });
      var onSampleResized = function(e){  
        table = $(e.currentTarget); //reference to the resized table
      }
      table.on( 'draw', function () {
          console.log( 'Redraw occurred at: '+new Date().getTime() );
      } );
      // $('.table').colResizable();
      // var init = function( tb, options){	
      //   var t = $(tb);				    //the table object is wrapped
      //       t.opt = options;                //each table has its own options available at anytime
      //       t.mode = options.resizeMode;    //shortcuts
      //       t.dc = t.opt.disabledColumns;
      //   if(t.opt.disable) return destroy(t);				//the user is asking to destroy a previously colResized table
      //   var	id = t.id = t.attr("id") || SIGNATURE+count++;	//its id is obtained, if null new one is generated		
      //   t.p = t.opt.postbackSafe; 							//short-cut to detect postback safe 		
      //   if(!t.is("table") || tables[id] && !t.opt.partialRefresh) return; 		//if the object is not a table or if it was already processed then it is ignored.
      //   if (t.opt.hoverCursor !== 'e-resize') h.append("<style type='text/css'>.JCLRgrip .JColResizer:hover{cursor:"+ t.opt.hoverCursor +"!important}</style>");  //if hoverCursor has been set, append the style
      //   t.addClass(SIGNATURE).attr("id", id).before('<div class="JCLRgrips"/>');	//the grips container object is added. Signature class forces table rendering in fixed-layout mode to prevent column's min-width
      //   t.g = []; t.c = []; t.w = t.width(); t.gc = t.prev(); t.f=t.opt.fixed;	//t.c and t.g are arrays of columns and grips respectively				
      //   if(options.marginLeft) t.gc.css("marginLeft", options.marginLeft);  	//if the table contains margins, it must be specified
      //   if(options.marginRight) t.gc.css("marginRight", options.marginRight);  	//since there is no (direct) way to obtain margin values in its original units (%, em, ...)
      //   t.cs = I(ie? tb.cellSpacing || tb.currentStyle.borderSpacing :t.css('border-spacing'))||2;	//table cellspacing (not even jQuery is fully cross-browser)
      //   t.b  = I(ie? tb.border || tb.currentStyle.borderLeftWidth :t.css('border-left-width'))||1;	//outer border width (again cross-browser issues)
      //   // if(!(tb.style.width || tb.width)) t.width(t.width()); //I am not an IE fan at all, but it is a pity that only IE has the currentStyle attribute working as expected. For this reason I can not check easily if the table has an explicit width or if it is rendered as "auto"
      //   tables[id] = t; 	//the table object is stored using its id as key	
      //   createGrips(t);		//grips are created 
      
      // };
      // var createGrips = function(t){	
      //   var th = t.find(">thead>tr:first>th,>thead>tr:first>td"); //table headers are obtained
      //   if(!th.length) th = t.find(">tbody>tr:first>th,>tr:first>th,>tbody>tr:first>td, >tr:first>td");	 //but headers can also be included in different ways
      //   th = th.filter(":visible");					//filter invisible columns
      //   t.cg = t.find("col"); 						//a table can also contain a colgroup with col elements		
      //   t.ln = th.length;							//table length is stored	
      //   if(t.p && S && S[t.id])memento(t,th);		//if 'postbackSafe' is enabled and there is data for the current table, its coloumn layout is restored
      //   th.each(function(i){						//iterate through the table column headers			
      //     var c = $(this); 						//jquery wrap for the current column		
      //         var dc = t.dc.indexOf(i)!=-1;           //is this a disabled column?
      //     var g = $(t.gc.append('<div class="JCLRgrip"></div>')[0].lastChild); //add the visual node to be used as grip
      //       g.append(dc ? "": t.opt.gripInnerHtml).append('<div class="'+SIGNATURE+'"></div>');
      //       if(i == t.ln-1){                        //if the current grip is the las one 
      //           g.addClass("JCLRLastGrip");         //add a different css class to stlye it in a different way if needed
      //           if(t.f) g.html("");                 //if the table resizing mode is set to fixed, the last grip is removed since table with can not change
      //       }
      //       g.bind('touchstart mousedown', onGripMouseDown); //bind the mousedown event to start dragging 
            
      //       if (!dc){ 
      //           //if normal column bind the mousedown event to start dragging, if disabled then apply its css class
      //           g.removeClass('JCLRdisabledGrip').bind('touchstart mousedown', onGripMouseDown);      
      //       }else{
      //           g.addClass('JCLRdisabledGrip'); 
      //       }

      //     g.t = t; g.i = i; g.c = c;	c.w =c.width();		//some values are stored in the grip's node data as shortcut
      //     t.g.push(g); t.c.push(c);						//the current grip and column are added to its table object
      //     c.width(c.w).removeAttr("width");				//the width of the column is converted into pixel-based measurements
      //     g.data(SIGNATURE, {i:i, t:t.attr("id"), last: i == t.ln-1});	 //grip index and its table name are stored in the HTML 												
      //   }); 	
      //   t.cg.removeAttr("width");	//remove the width attribute from elements in the colgroup 

      //   t.find('td, th').not(th).not('table th, table td').each(function(){  
      //     $(this).removeAttr('width');	//the width attribute is removed from all table cells which are not nested in other tables and dont belong to the header
      //   });		
      //   if(!t.f){
      //       t.removeAttr('width').addClass(FLEX); //if not fixed, let the table grow as needed
      //   }
      //   syncGrips(t); 				//the grips are positioned according to the current table layout			
      //   //there is a small problem, some cells in the table could contain dimension values interfering with the 
      //   //width value set by this plugin. Those values are removed
      // };
    });
  </script>
</html>